<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII Art Webcam</title>
    <link rel="stylesheet" href="styles/index.css">
</head>
<body>
    <video id="cam" autoplay playsinline></video>
    
    <!-- Main canvas -->
    <div class="canvas-container">
<canvas id="gfx" width="1280" height="720"></canvas>
    </div>

    <!-- Header with controls -->
    <div class="header">
        <div class="title">ASCII Art Webcam</div>
        
        <div class="controls">
            <div class="control-group">
                <label>Width:</label>
                <input type="range" id="width" min="40" max="200" value="80" step="10">
                <span id="widthValue"></span>
            </div>
            
            <div class="control-group">
                <label>Height:</label>
                <input type="range" id="height" min="30" max="120" value="30" step="5">
                <span id="heightValue"></span>
            </div>
            
            <div class="control-group">
                <label>Contrast:</label>
                <input type="range" id="contrast" min="0.5" max="2.0" value="1.1" step="0.1">
                <span id="contrastValue"></span>
            </div>
            
            <div class="control-group">
                <label>Edge Bias:</label>
                <input type="range" id="edgeBias" min="0.0" max="1.0" value="0.35" step="0.05">
                <span id="edgeBiasValue"></span>
            </div>
            
            <div class="control-group">
                <label>Invert:</label>
                <input type="checkbox" id="invert">
            </div>
            
            <div class="control-group">
                <label>Atlas:</label>
                <select id="atlas"></select>
            </div>
            
            <button class="help-button" onclick="showHelp()">?</button>
            <button class="help-button" onclick="toggleWebcam()" id="webcamToggle">ðŸ“¹</button>
        </div>
    </div>

    <!-- Status display -->
    <div class="status" id="status">
        Ready | Press 'H' for help
    </div>

    <!-- Loading indicator -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        Initializing WebGPU...
    </div>

    <!-- Help modal -->
    <div class="help hidden" id="help">
        <div class="close" onclick="hideHelp()">&times;</div>
        <h2>ASCII Art Webcam Help</h2>
        
        <p><strong>What is this?</strong><br>
        This application converts your webcam feed into real-time ASCII art using WebGPU for high performance.</p>
        
        <p><strong>Controls:</strong></p>
        <ul class="help-list">
            <li><strong>Width/Height:</strong> Adjust the ASCII grid resolution</li>
            <li><strong>Contrast:</strong> Increase for more dramatic light/dark separation</li>
            <li><strong>Edge Bias:</strong> Emphasize edges with darker characters</li>
            <li><strong>Invert:</strong> Swap light and dark characters</li>
            <li><strong>Style:</strong> Choose between dense character set or block characters</li>
        </ul>
        
        <p><strong>Keyboard Shortcuts:</strong></p>
        <ul class="help-list">
            <li><strong>H:</strong> Show/hide this help</li>
            <li><strong>W:</strong> Toggle webcam visibility</li>
            <li><strong>Space:</strong> Pause/resume</li>
        </ul>
        
        <p><strong>Performance Tips:</strong><br>
        Lower resolutions (width Ã— height) will run faster. The application uses WebGPU for hardware acceleration.</p>
        
        <p><strong>Browser Requirements:</strong><br>
        This requires a modern browser with WebGPU support (Chrome 113+, Edge 113+, or Firefox Nightly).</p>
    </div>

    <!-- Error display -->
    <div class="error hidden" id="error"></div>

    <script type="module" src="scripts/index.ts"></script>
    <script type="module" src="scripts/debug.ts"></script>
    
    <script>
        // Control synchronization
        const controls = {
            width: document.getElementById('width'),
            height: document.getElementById('height'),
            contrast: document.getElementById('contrast'),
            edgeBias: document.getElementById('edgeBias'),
            invert: document.getElementById('invert'),
            atlas: document.getElementById('atlas')
        };

        const values = {
            width: document.getElementById('widthValue'),
            height: document.getElementById('heightValue'),
            contrast: document.getElementById('contrastValue'),
            edgeBias: document.getElementById('edgeBiasValue')
        };

        // Initialize defaults from constants.ts DefaultSettings
        import('./scripts/constants.ts').then(({ DefaultSettings }) => {
            controls.width.value = String(DefaultSettings.WIDTH);
            controls.height.value = String(DefaultSettings.HEIGHT);
            controls.contrast.value = String(DefaultSettings.CONTRAST);
            controls.edgeBias.value = String(DefaultSettings.EDGE_BIAS);
            controls.invert.checked = !!DefaultSettings.INVERT;
            values.width.textContent = String(DefaultSettings.WIDTH);
            values.height.textContent = String(DefaultSettings.HEIGHT);
            values.contrast.textContent = String(DefaultSettings.CONTRAST);
            values.edgeBias.textContent = String(DefaultSettings.EDGE_BIAS);
            const atlasSel = controls.atlas;
            atlasSel.innerHTML = '';
            const opt = document.createElement('option');
            opt.value = DefaultSettings.ATLAS;
            opt.textContent = DefaultSettings.ATLAS.charAt(0).toUpperCase() + DefaultSettings.ATLAS.slice(1);
            atlasSel.appendChild(opt);
        });

        // Update value displays
        Object.keys(controls).forEach(key => {
            if (controls[key].type === 'range') {
                controls[key].addEventListener('input', (e) => {
                    values[key].textContent = e.target.value;
                });
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            switch(e.key.toLowerCase()) {
                case 'h':
                    e.preventDefault();
                    showHelp();
                    break;
                case 'w':
                    e.preventDefault();
                    toggleWebcam();
                    break;
            }
        });

        function showHelp() {
            document.getElementById('help').classList.remove('hidden');
        }

        function hideHelp() {
            document.getElementById('help').classList.add('hidden');
        }

        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        function showError(message) {
            const error = document.getElementById('error');
            error.textContent = message;
            error.classList.remove('hidden');
        }

        function toggleWebcam() {
            const webcam = document.getElementById('cam');
            const toggle = document.getElementById('webcamToggle');
            
            if (webcam.style.display === 'none') {
                webcam.style.display = 'block';
                toggle.textContent = 'ðŸ“¹';
                toggle.title = 'Hide webcam';
            } else {
                webcam.style.display = 'none';
                toggle.textContent = 'ðŸ“·';
                toggle.title = 'Show webcam';
            }
        }

        // Expose functions to main script
        window.appControls = {
            updateStatus,
            hideLoading,
            // showError etc...
        };
    </script>
</body>
</html>
